name: Deploy Multi-Entorno

on:
  push:
    branches: [ master ]

jobs:
  # deploy-vps:
  #   runs-on: ubuntu-latest
  #   steps:
  #     - uses: actions/checkout@v4
  #     - name: FTP Deploy a Dattaweb (VPS)
  #       uses: SamKirkland/FTP-Deploy-Action@v4.3.5
  #       with:
  #         server: ${{ secrets.FTP_HOST }}
  #         username: ${{ secrets.FTP_USER }}
  #         password: ${{ secrets.FTP_PASS }}

deploy-local:
    needs: deploy-vps
    steps:
      - name: ðŸ“‹ Verificar estado previo
        run: |
          echo "Usuario ejecutando: $(whoami)"
          echo "Directorio actual: $(pwd)"
          echo "--- Estado del contenedor antes del restart ---"
          docker ps --filter "name=nombre_del_contenedor_ftp" --format "ID: {{.ID}} | Status: {{.Status}} | Up time: {{.RunningFor}}"

      - name: ðŸ“¥ Actualizar CÃ³digo Local
        run: |
          cd /ruta/a/tu/proyecto
          echo "Obteniendo cambios de GitHub..."
          git fetch origin main
          
          # Esto nos dirÃ¡ exactamente quÃ© archivos cambiaron en la consola
          echo "Archivos que se van a actualizar:"
          git diff --name-status main origin/main
          
          git pull origin main
          echo "âœ… CÃ³digo actualizado correctamente."

      - name: ðŸ”„ Reiniciar Docker FTP y Validar
        run: |
          echo "Reiniciando contenedor..."
          docker restart nombre_del_contenedor_ftp
          
          # Esperamos 2 segundos para que el contenedor intente subir
          sleep 2
          
          echo "--- Estado del contenedor despuÃ©s del restart ---"
          docker ps --filter "name=nombre_del_contenedor_ftp" --format "ID: {{.ID}} | Status: {{.Status}}"
          
          echo "âœ… El archivo example.txt ahora deberÃ­a estar disponible."
          ls -lh /ruta/a/tu/proyecto/example.txt