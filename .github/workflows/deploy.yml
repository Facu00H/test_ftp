name: Deploy Multi-Entorno

on:
  push:
    branches: [ master ]

jobs:
  # El bloque de VPS estÃ¡ comentado, por lo que no existe.
  # Al no haber 'needs', este serÃ¡ el primer y Ãºnico trabajo en ejecutarse.

  deploy-local:
    runs-on: self-hosted
    steps:
      - name: ðŸ“‹ Verificar estado previo
        run: |
          echo "Usuario ejecutando: $(whoami)"
          echo "Directorio actual: $(pwd)"
          echo "--- Estado del contenedor antes del restart ---"
          # Usamos || true para que no falle si el contenedor no existe aÃºn
          docker ps --filter "name=nombre_del_contenedor_ftp" --format "ID: {{.ID}} | Status: {{.Status}}" || true

      - name: ðŸ“¥ Actualizar CÃ³digo Local
        run: |
          # RECUERDA: Cambia /ruta/a/tu/proyecto por la ruta real (ej: /home/facundo/test_ftp)
          cd /ruta/a/tu/proyecto
          echo "Obteniendo cambios de GitHub..."
          git fetch origin master
          
          echo "Archivos que se van a actualizar:"
          git diff --name-status master origin/master
          
          git pull origin master
          echo "âœ… CÃ³digo actualizado correctamente."

      - name: ðŸ”„ Reiniciar Docker FTP y Validar
        run: |
          # Cambia 'nombre_del_contenedor_ftp' por el nombre real de tu contenedor
          docker restart nombre_del_contenedor_ftp || echo "No se pudo reiniciar el contenedor"
          
          sleep 2
          
          echo "--- Estado del contenedor despuÃ©s del restart ---"
          docker ps --filter "name=nombre_del_contenedor_ftp" --format "ID: {{.ID}} | Status: {{.Status}}"
          
          echo "âœ… El archivo example.txt ahora deberÃ­a estar disponible."
          # Verifica la ruta aquÃ­ tambiÃ©n
          ls -lh /ruta/a/tu/proyecto/example.txt || true